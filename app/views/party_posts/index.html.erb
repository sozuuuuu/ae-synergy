<div>
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-4xl font-bold text-gray-900">
        <% if @character.present? %>
          <%= @character.name %>„Çí‰Ωø„Å£„Åü<%= @composition_type == 'synergy' ? '„Ç∑„Éä„Ç∏„Éº' : '„Éë„Éº„ÉÜ„Ç£Á∑®Êàê' %>
        <% else %>
          <%= @composition_type == 'synergy' ? '„Ç∑„Éä„Ç∏„ÉºÊäïÁ®ø' : '„Éë„Éº„ÉÜ„Ç£Á∑®ÊàêÊäïÁ®ø' %>
        <% end %>
      </h1>
      <% if @character.present? %>
        <%= link_to "‚Üê #{@character.name}„ÅÆ„Éö„Éº„Ç∏„Å´Êàª„Çã", character_path(@character), class: "text-indigo-600 hover:text-indigo-800 mt-2 inline-block" %>
      <% end %>
    </div>
    <% if logged_in? %>
      <%= link_to @composition_type == 'synergy' ? 'Êñ∞„Åó„ÅÑ„Ç∑„Éä„Ç∏„Éº„ÇíÊäïÁ®ø' : 'Êñ∞„Åó„ÅÑ„Éë„Éº„ÉÜ„Ç£„ÇíÊäïÁ®ø', "#", class: "bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded font-semibold" %>
    <% end %>
  </div>

  <div class="grid grid-cols-1 gap-6">
    <% @party_posts.each do |post| %>
      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
        <div class="flex justify-between items-start mb-4">
          <div class="flex-1">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">
              <%= link_to post.title, post.synergy? ? synergy_post_path(post) : party_post_path(post), class: "hover:text-indigo-600" %>
            </h2>
            <p class="text-sm text-gray-600 mb-3">
              ÊäïÁ®øËÄÖ: <%= post.user.username %>
            </p>
          </div>
          <div class="flex items-center space-x-2 ml-4">
            <span class="text-2xl">üëç</span>
            <span class="text-xl font-semibold text-gray-700"><%= post.votes_count %></span>
          </div>
        </div>

        <div class="mb-4">
          <% if post.full_party? %>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <div class="text-sm text-gray-600 mb-2 font-semibold">„É°„Ç§„É≥„É°„É≥„Éê„Éº:</div>
                <div class="flex flex-wrap gap-2">
                  <% post.main_members.each do |membership| %>
                    <%= link_to character_path(membership.character), class: "block" do %>
                      <div class="inline-flex items-center gap-2 bg-indigo-50 border border-indigo-200 hover:border-indigo-400 rounded-lg px-2 py-1 transition">
                        <% image_url = membership.character.display_image_for(current_user) %>
                        <% if image_url.present? %>
                          <img src="<%= image_url %>" alt="<%= membership.character.name %>" class="w-8 h-8 object-cover rounded">
                        <% else %>
                          <div class="w-8 h-8 bg-gradient-to-br from-indigo-400 to-purple-500 rounded flex items-center justify-center flex-shrink-0">
                            <span class="text-xs text-white">?</span>
                          </div>
                        <% end %>
                        <span class="text-sm font-medium text-indigo-900"><%= membership.character.name %></span>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>

              <div>
                <div class="text-sm text-gray-600 mb-2 font-semibold">„Çµ„Éñ„É°„É≥„Éê„Éº:</div>
                <div class="flex flex-wrap gap-2">
                  <% post.sub_members.each do |membership| %>
                    <%= link_to character_path(membership.character), class: "block" do %>
                      <div class="inline-flex items-center gap-2 bg-purple-50 border border-purple-200 hover:border-purple-400 rounded-lg px-2 py-1 transition">
                        <% image_url = membership.character.display_image_for(current_user) %>
                        <% if image_url.present? %>
                          <img src="<%= image_url %>" alt="<%= membership.character.name %>" class="w-8 h-8 object-cover rounded">
                        <% else %>
                          <div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-500 rounded flex items-center justify-center flex-shrink-0">
                            <span class="text-xs text-white">?</span>
                          </div>
                        <% end %>
                        <span class="text-sm font-medium text-purple-900"><%= membership.character.name %></span>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          <% else %>
            <div class="text-sm text-gray-600 mb-2 font-semibold">„Ç≠„É£„É©„ÇØ„Çø„Éº:</div>
            <div class="flex flex-wrap gap-2">
              <% post.characters.each do |character| %>
                <%= link_to character_path(character), class: "block" do %>
                  <div class="inline-flex items-center gap-2 bg-blue-50 border border-blue-200 hover:border-blue-400 rounded-lg px-2 py-1 transition">
                    <% image_url = character.display_image_for(current_user) %>
                    <% if image_url.present? %>
                      <img src="<%= image_url %>" alt="<%= character.name %>" class="w-8 h-8 object-cover rounded">
                    <% else %>
                      <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-cyan-500 rounded flex items-center justify-center flex-shrink-0">
                        <span class="text-xs text-white">?</span>
                      </div>
                    <% end %>
                    <span class="text-sm font-medium text-blue-900"><%= character.name %></span>
                  </div>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>

        <p class="text-gray-700 mb-4 line-clamp-3"><%= post.description %></p>

        <% if post.use_case_tags.any? %>
          <div class="flex flex-wrap gap-2">
            <% post.use_case_tags.each do |tag| %>
              <span class="inline-block bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded"><%= tag.name %></span>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if @party_posts.empty? %>
    <div class="text-center py-12 bg-white rounded-lg shadow-md">
      <p class="text-gray-500 text-lg">„Åæ„Å†<%= @composition_type == 'synergy' ? '„Ç∑„Éä„Ç∏„Éº' : '„Éë„Éº„ÉÜ„Ç£' %>ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
      <% if logged_in? %>
        <p class="text-gray-400 mt-2">ÊúÄÂàù„ÅÆÊäïÁ®øËÄÖ„Å´„Å™„Çä„Åæ„Åó„Çá„ÅÜÔºÅ</p>
      <% end %>
    </div>
  <% end %>

  <div class="mt-8">
    <%= paginate @party_posts %>
  </div>
</div>
